<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>聯絡人列表</title>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <link rel="manifest" href="/manifest.json" />
  </head>

  <body>
    <h1 class="text-center mt-4">聯絡人列表</h1>
    <nav class="text-center mt-4">
      <ul class="list-inline">
        <li class="list-inline-item">
          <a href="{{ url_for('index') }}" class="btn btn-secondary">首頁</a>
        </li>
        <li class="list-inline-item">
          <a href="{{ url_for('search') }}" class="btn btn-secondary">搜尋</a>
        </li>
        <li class="list-inline-item">
          <a href="{{ url_for('search_email') }}" class="btn btn-secondary"
            >電子郵件搜尋</a
          >
        </li>
        <li class="list-inline-item">
          <a href="{{ url_for('upload') }}" class="btn btn-secondary">上傳</a>
        </li>
        <li class="list-inline-item">
          <a
            href="{{ url_for('select_contact_to_edit') }}"
            class="btn btn-secondary"
            >修改</a
          >
        </li>
        <li class="list-inline-item">
          <a
            href="{{ url_for('select_contact_to_delete') }}"
            class="btn btn-secondary"
            >刪除</a
          >
        </li>
        <li class="list-inline-item">
          <a href="{{ url_for('logout') }}" class="btn btn-secondary">登出</a>
        </li>
      </ul>
    </nav>

    <table id="contact-table" class="table table-striped table-bordered mt-4">
      <thead class="thead-light">
        <tr>
          <th onclick="sortTable(0)">名字</th>
          <th onclick="sortTable(1)">姓氏</th>
          <th onclick="sortTable(2)">電子郵件</th>
          <th onclick="sortTable(3)">電子郵件二</th>
          <th onclick="sortTable(4)">辦公電話</th>
          <th onclick="sortTable(5)">手機</th>
          <th onclick="sortTable(6)">其他電話</th>
          <th onclick="sortTable(7)">主要電話</th>
          <th onclick="sortTable(8)">商務傳真</th>
          <th onclick="sortTable(9)">職位</th>
          <th onclick="sortTable(10)">公司名</th>
          <th onclick="sortTable(11)">地址</th>
          <th onclick="sortTable(12)">城市</th>
          <th onclick="sortTable(13)">州</th>
          <th onclick="sortTable(14)">郵遞區號</th>
          <th onclick="sortTable(15)">國家</th>
          <th onclick="sortTable(16)">個人網站</th>
          <th onclick="sortTable(17)">網站</th>
          <th onclick="sortTable(18)">生日</th>
          <th onclick="sortTable(19)">註釋</th>
          <th onclick="sortTable(20)">標籤</th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for contact in contacts %}
        <tr>
          <td>{{ contact.first_name }}</td>
          <td>{{ contact.last_name }}</td>
          <td>{{ contact.email_address }}</td>
          <td>{{ contact.email_address_2 }}</td>
          <td>{{ contact.business_phone }}</td>
          <td>{{ contact.mobile_phone }}</td>
          <td>{{ contact.other_phone }}</td>
          <td>{{ contact.primary_phone }}</td>
          <td>{{ contact.business_fax }}</td>
          <td>{{ contact.job_title }}</td>
          <td>{{ contact.company }}</td>
          <td>{{ contact.business_address }}</td>
          <td>{{ contact.business_city }}</td>
          <td>{{ contact.business_state }}</td>
          <td>{{ contact.business_zip }}</td>
          <td>{{ contact.business_country }}</td>
          <td>{{ contact.personal_website }}</td>
          <td>{{ contact.web_page }}</td>
          <td>{{ contact.birthday }}</td>
          <td>{{ contact.notes }}</td>
          <td>{{ contact.tag }}</td>
          <td>
            <a
              href="{{ url_for('delete', contact_id=contact.id) }}"
              class="btn btn-danger"
              >刪除</a
            >
          </td>
          <td>
            <a
              href="{{ url_for('edit', contact_id=contact.id) }}"
              class="btn btn-primary"
              >修改</a
            >
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
      function sortTable(columnIndex) {
        var table,
          rows,
          switching,
          i,
          x,
          y,
          shouldSwitch,
          dir,
          switchcount = 0;
        table = document.getElementById("contact-table");
        switching = true;
        dir = "asc"; // Set the default direction to ascending

        while (switching) {
          switching = false;
          rows = table.rows;

          for (i = 1; i < rows.length - 1; i++) {
            shouldSwitch = false;
            x = rows[i].getElementsByTagName("td")[columnIndex];
            y = rows[i + 1].getElementsByTagName("td")[columnIndex];

            if (dir == "asc") {
              if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                shouldSwitch = true;
                break;
              }
            } else if (dir == "desc") {
              if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                shouldSwitch = true;
                break;
              }
            }
          }

          if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount++;
          } else {
            if (switchcount == 0 && dir == "asc") {
              dir = "desc";
              switching = true;
            }
          }

          // Remove existing direction indicators
          var headers = table.getElementsByTagName("th");
          for (var j = 0; j < headers.length; j++) {
            headers[j].classList.remove("asc", "desc");
          }

          // Add direction indicator to the clicked column
          headers[columnIndex].classList.toggle(dir);
        }
      }
    </script>
  </body>
</html>
